<div class="container">

  <div class="row">

    <div class="col-md-4">

      <table class="table table-bordered genre-table table-hover" width="60">
        <thead>
          <tr class="genre-title">
            <th><strong>エリアから探す</strong></th>
          </tr>
        </thead>
        <tbody>

        <% Area.all.each do |area| %>
          <tr>
            <td>
              <%= link_to area.name, search_path('search[value]': area.id, 'search[how]': "match",'search[target]': "area"),class:"genre-link" %>
            </td>
          </tr>
        <% end %>

        </tbody>
      </table>

      <table class="table table-bordered genre-table table-hover">
        <thead>
          <tr class="genre-title">
            <th><strong>雰囲気から探す</strong></th>
          </tr>
        </thead>
        <tbody>
        <% Atmosphere.all.each do |atmosphere| %>
          <tr>
            <td>
              <%= link_to atmosphere.atmosphere, search_path('search[value]': atmosphere.id, 'search[how]': "match",'search[target]': "atmosphere"),class:"genre-link" %>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>

    <div class="col-md-7">
      <div class="ml-5">
      <h4 class="index-title"><i class="fas fa-store" style="color: #5A3E26;"></i><strong>  店舗一覧</strong></h4>
      <% @shops.each do |shop| %>
      <% @shop = shop %>
      <div class="container">
        <div class="row">
        <div class="col-6">
          <%= link_to shop_path(shop), class: "btn-link" do %>
            <div class="img-thumbnail shop-image">
              <%= attachment_image_tag shop, :image, format: 'jpeg', class: "shop-img" %>
            </div>
                    <%# カラムはimage_idだがrefileの仕様でidは書かない %>
          <% end %>
        </div>
        <div class="col-6">


          <div class="shop-detail">
            <h5 class="shop-name"><strong>店名  <%= shop.name %></strong></h5>
            <div id="favorite_shop_<%= shop.id %>" class="favorite-candidate">
            <%= render 'favorite', shop: shop %>
            </div>
            <div id="candidate_shop_<%= shop.id %>" class="favorite-candidate">
              <%= render 'candidate', shop: shop %>
            </div>
            <div class="average-review-rating" data-score=<%= (shop.comments.average(:rate)) %>></div><%# average = 平均を計算 %>

            営業日 <i class="fas fa-angle-right" style="color: #4d4d4d;"></i> <%= shop.business_day %><br>
            販売形式
            <i class="fas fa-angle-right" style="color: #4d4d4d;"></i> <%= shop.eat_in == "1" ? "イートイン  " : "" %><%= shop.take_out == "1" ? "テイクアウト" : "" %><br>
            予算 <i class="fas fa-angle-right" style="color: #4d4d4d;"></i> <%= shop.budget %><br>
            エリア <i class="fas fa-angle-right" style="color: #4d4d4d;"></i> <%= shop.area.name %><br>
            店舗ジャンル <i class="fas fa-angle-right" style="color: #4d4d4d;"></i> <%= shop.atmosphere.atmosphere %><br>
          </div>
        </div>
        </div>
      </div>
      <% end %>
    </div>
    </div>

  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="pagination" style="text-align:center"><%= paginate(@shops) %></div>
    </div>
  </div>
</div>

<script>
  <%# eachの中にscriptタグを入れる場合はIDの指定をしないと複数のscriptタグが生成されてしまう %>
  $('.average-review-rating').raty({
    readOnly: true,
    starOn: "<%= asset_path('star-on.png') %>",
    starOff: "<%= asset_path('star-off.png') %>",
    starHalf: "<%= asset_path('star-half.png') %>",
    score: function() {
      return $(this).attr('data-score')
    }
  });
</script>